#include "string.h"
#include "SRF05.h"
#include <AFMotor.h>

unsigned int Speed = 255;
unsigned int distance;
char blth;
bool temp;
String voice;

#define trigger 12
#define echo 13
#define MAX_DISTANCE 300
#define IR A5
#define l_motor 9  // ENA
#define l_motor_in1 7
#define l_motor_in2 6
#define r_motor 10 // ENB
#define r_motor_in3 4
#define r_motor_in4 5

AF_DCMotor motor1(1, MOTOR12_1KHZ);
AF_DCMotor motor2(2, MOTOR12_1KHZ);
AF_DCMotor motor3(3, MOTOR34_1KHZ);
AF_DCMotor motor4(4, MOTOR34_1KHZ);

SRF05 SRF(trigger, echo);

void setup() {
  pinMode(2,OUTPUT);
  pinMode(3,OUTPUT);
  Serial.begin(9600);
  pinMode(IR, INPUT);
  if (Serial.available() > 0)
    Serial.print("\tBluetooth Connected Seccessfully.\a");
  SRF.setCorrectionFactor(1.035);
}

void loop() {

  if (Serial.available() > 0) {
    voice = "";
    delay(2);
    voice = Serial.readString();
    delay(2);
    Serial.println(voice);
  }



  if ((voice == "turn lift") || (voice == "lift") || (voice == "go left"))
  {
    backward();
    voice = "";
  }

  if ((voice == "turn right") || (voice == "right") || (voice == "go right"))
  {
    forward();
    voice = "";
  }

  if ((voice == "forward") || (voice == "go forward"))
    right();

  if ((voice == "backward") || (voice == "go backward"))
    left();

  if (voice == "lights on")
    digitalWrite(2,HIGH);

  if (voice == "lights off")
    digitalWrite(2,LOW);

  if (voice == "back lights on")
  {
    digitalWrite(3,HIGH);
    back_blink();
  }

  if (voice == "back lights off")
    digitalWrite(3,LOW);

  if (voice == "low speed")
    Speed = 50;

  if (voice == "medium speed")
    Speed = 150;

  if (voice == "high speed")
    Speed = 255;

  if (voice == "stop")
    Stop();
}




void forward() {
  digitalWrite(l_motor_in1, LOW);
  digitalWrite(l_motor_in2, HIGH);
  analogWrite(l_motor, Speed);

  digitalWrite(r_motor_in3, LOW);
  digitalWrite(r_motor_in4, HIGH);
  analogWrite(r_motor, Speed);
}

void backward() {
  digitalWrite(l_motor_in1, HIGH);
  digitalWrite(l_motor_in2, LOW);
  analogWrite(l_motor, Speed);

  digitalWrite(r_motor_in3, HIGH);
  digitalWrite(r_motor_in4, LOW);
  analogWrite(r_motor, Speed);
}

void left() {
  digitalWrite(l_motor_in1, LOW);
  digitalWrite(l_motor_in2, HIGH);
  analogWrite(l_motor, Speed);

  digitalWrite(r_motor_in3, HIGH);
  digitalWrite(r_motor_in4, LOW);
  analogWrite(r_motor, Speed);
}

void right() {
  digitalWrite(l_motor_in1, HIGH);
  digitalWrite(l_motor_in2, LOW);
  analogWrite(l_motor, Speed);

  digitalWrite(r_motor_in3, LOW);
  digitalWrite(r_motor_in4, HIGH);
  analogWrite(r_motor, Speed);
}

void Stop() {
  digitalWrite(l_motor_in1, HIGH);
  digitalWrite(l_motor_in2, LOW);
  analogWrite(l_motor, 0);

  digitalWrite(r_motor_in3, HIGH);
  digitalWrite(r_motor_in4, LOW);
  analogWrite(r_motor, 0);
}


void back_blink() {
  digitalWrite(3,HIGH);
  delay(300);
  digitalWrite(3,LOW);
  delay(300);
}
